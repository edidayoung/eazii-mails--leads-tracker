<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Eazii Mails - Leads tracker</title>
<!-- Blue envelope favicon -->
<!-- Emoji favicon (üìß Email icon) -->
<link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üìß</text></svg>">



<style>
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }

    body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
        background: #f8f9fa;
        color: #1a1a1a;
        height: 100vh;
        overflow: hidden;
    }

    .main-container {
        display: grid;
        grid-template-columns: 1fr 350px;
        height: 100vh;
        gap: 0;
    }

    .left-section {
        padding: 30px;
        overflow-y: auto;
        background: #fff;
    }

    .right-section {
        background: #f8f9fa;
        border-left: 1px solid #e9ecef;
        display: flex;
        flex-direction: column;
        height: 100vh;
    }

    .header {
        margin-bottom: 30px;
    }

    .header h1 {
        font-size: 2em;
        font-weight: 700;
        color: #1a1a1a;
        margin-bottom: 8px;
    }

    .header p {
        color: #6c757d;
        font-size: 1em;
    }

    .controls {
        background: #f8f9fa;
        padding: 20px;
        border-radius: 12px;
        margin-bottom: 24px;
        border: 1px solid #e9ecef;
    }

    .file-input-wrapper {
        position: relative;
        overflow: hidden;
        display: inline-block;
        width: 100%;
        margin-bottom: 16px;
    }

    .file-input-label {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
        padding: 14px;
        background: #4F46E5;
        color: #fff;
        border-radius: 8px;
        cursor: pointer;
        font-weight: 600;
        transition: all 0.2s;
    }

    .file-input-label:hover {
        background: #4338CA;
    }

    .file-input-wrapper input[type=file] {
        position: absolute;
        left: -9999px;
    }

    .search-filter-row {
        display: grid;
        grid-template-columns: 1fr auto auto auto auto auto;
        gap: 10px;
    }

    .search-box {
        padding: 10px 14px;
        border: 2px solid #e9ecef;
        background: #fff;
        color: #1a1a1a;
        border-radius: 8px;
        font-size: 0.95em;
        transition: all 0.2s;
    }

    .search-box:focus {
        outline: none;
        border-color: #4F46E5;
    }

    .filter-btn {
        padding: 10px 16px;
        border: 2px solid #e9ecef;
        background: #fff;
        color: #6c757d;
        border-radius: 8px;
        cursor: pointer;
        font-weight: 600;
        transition: all 0.2s;
        white-space: nowrap;
        font-size: 0.9em;
    }

    .filter-btn:hover {
        border-color: #4F46E5;
        color: #4F46E5;
    }

    .filter-btn.active {
        background: #4F46E5;
        color: #fff;
        border-color: #4F46E5;
    }

    .leads-container {
        flex: 1;
        overflow-y: auto;
        padding: 20px;
    }

    .leads-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
        gap: 16px;
    }

    .lead-card {
        background: #fff;
        padding: 18px;
        border-radius: 10px;
        box-shadow: 0 2px 6px rgba(0,0,0,0.08);
        transition: all 0.2s;
        border: 2px solid transparent;
        display: flex;
        flex-direction: column;
        height: 100%;
    }

    .lead-card:hover {
        box-shadow: 0 4px 12px rgba(0,0,0,0.12);
        border-color: #4F46E5;
    }

    .lead-card.in-progress {
        background: #fffbeb;
        border-color: #F59E0B;
    }

    .lead-card.completed {
        background: #f0fdf4;
        border-color: #10B981;
    }

    .lead-header {
        display: flex;
        align-items: flex-start;
        gap: 10px;
    }

    .checkbox {
        width: 22px;
        height: 22px;
        min-width: 22px;
        border: 2px solid #d1d5db;
        border-radius: 6px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all 0.2s;
        margin-top: 2px;
    }

    .checkbox:hover {
        border-color: #4F46E5;
    }

    .checkbox.in-progress {
        background: #F59E0B;
        border-color: #F59E0B;
    }

    .checkbox.checked {
        background: #10B981;
        border-color: #10B981;
    }

    .checkbox svg {
        width: 14px;
        height: 14px;
        stroke: #fff;
        stroke-width: 3;
    }

    .lead-info {
        flex: 1;
    }

    .lead-name {
        font-size: 1em;
        font-weight: 600;
        color: #1a1a1a;
        margin-bottom: 8px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 8px;
        word-break: break-word;
    }

    .name-text {
        flex: 1;
    }

    .copy-btn {
        padding: 3px 8px;
        background: #e9ecef;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 0.7em;
        color: #6c757d;
        transition: all 0.2s;
        font-weight: 600;
        white-space: nowrap;
    }

    .copy-btn:hover {
        background: #4F46E5;
        color: #fff;
    }

    .lead-detail {
        display: flex;
        align-items: center;
        gap: 6px;
        color: #6c757d;
        font-size: 0.85em;
        margin-bottom: 6px;
        word-break: break-word;
        line-height: 1.4;
    }

    .detail-content {
        display: flex;
        align-items: center;
        gap: 6px;
        flex: 1;
    }

    .detail-text {
        flex: 1;
    }

    .notes-section {
        display: none;
    }

    .notes-input {
        display: none;
    }

    .stats-section {
        padding: 20px;
        border-bottom: 1px solid #e9ecef;
    }

    .stats-section h2 {
        font-size: 1.2em;
        margin-bottom: 16px;
        color: #1a1a1a;
    }

    .stat-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 12px 0;
        border-bottom: 1px solid #e9ecef;
    }

    .stat-item:last-child {
        border-bottom: none;
    }

    .stat-label {
        color: #6c757d;
        font-size: 0.9em;
        font-weight: 500;
    }

    .stat-value {
        font-size: 1.4em;
        font-weight: 700;
        color: #1a1a1a;
    }

    .export-section {
        padding: 20px;
        border-top: 1px solid #e9ecef;
    }

    .export-btn {
        width: 100%;
        padding: 14px;
        background: #10B981;
        color: #fff;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-weight: 600;
        transition: all 0.2s;
        font-size: 1em;
    }

    .export-btn:hover {
        background: #059669;
    }

    .empty-state {
        text-align: center;
        padding: 60px 20px;
        color: #6c757d;
    }

    .empty-state h3 {
        margin-bottom: 8px;
        color: #1a1a1a;
    }

    @media (max-width: 1024px) {
        .main-container {
            grid-template-columns: 1fr;
            grid-template-rows: auto 1fr;
        }

        .right-section {
            border-left: none;
            border-top: 1px solid #e9ecef;
            height: auto;
            max-height: 300px;
        }

        .left-section {
            height: auto;
        }

        .leads-grid {
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
        }
    }

    @media (max-width: 768px) {
        .left-section {
            padding: 20px;
        }

        .header h1 {
            font-size: 1.6em;
        }

        .search-filter-row {
            grid-template-columns: 1fr;
        }

        .stat-value {
            font-size: 1.2em;
        }

        .leads-grid {
            grid-template-columns: 1fr;
        }
    }

    .toast {
        position: fixed;
        bottom: 20px;
        right: 20px;
        background: #1a1a1a;
        color: #fff;
        padding: 12px 20px;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        opacity: 0;
        transform: translateY(20px);
        transition: all 0.3s;
        z-index: 1000;
    }

    .toast.show {
        opacity: 1;
        transform: translateY(0);
    }
</style>
</head>
<body>
<div class="main-container">
    <div class="left-section">
        <div class="header">
            <h1>Lead Tracker</h1>
            <p>Manage and track your leads efficiently</p>
        </div>

        <div class="controls">
            <div class="file-input-wrapper">
                <label class="file-input-label" for="csvFile">
                    <span>üìÅ</span>
                    <span>Upload CSV or Excel File</span>
                </label>
                <input type="file" id="csvFile" accept=".csv,.xlsx,.xls">
            </div>

            <div class="search-filter-row">
                <input type="text" class="search-box" id="searchBox" placeholder="Search leads...">
                <button class="filter-btn active" data-filter="all">All</button>
                <button class="filter-btn" data-filter="todo">To Do</button>
                <button class="filter-btn" data-filter="progress">In Progress</button>
                <button class="filter-btn" data-filter="done">Done</button>
            </div>
        </div>

        <div id="leadsList" class="leads-grid">
            <div class="empty-state">
                <h3>No Leads Yet</h3>
                <p>Upload a CSV or Excel file to get started</p>
            </div>
        </div>
    </div>

    <div class="right-section">
        <div class="stats-section">
            <h2>Progress</h2>
            <div class="stat-item">
                <span class="stat-label">Total Leads</span>
                <span class="stat-value" id="totalLeads">0</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">In Progress</span>
                <span class="stat-value" id="inProgressLeads" style="color: #F59E0B;">0</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">Completed</span>
                <span class="stat-value" id="completedLeads" style="color: #10B981;">0</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">To Go</span>
                <span class="stat-value" id="toGoLeads">0</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">Progress</span>
                <span class="stat-value" id="progressPercent">0%</span>
            </div>
        </div>

        <div class="leads-container">
            <h2 style="font-size: 1.2em; margin-bottom: 16px; color: #1a1a1a;">Quick View</h2>
            <div id="quickLeadsList">
                <div class="empty-state">
                    <p>Leads will appear here</p>
                </div>
            </div>
        </div>

        <div class="export-section">
            <button class="export-btn" id="exportBtn">üíæ Export CSV</button>
        </div>
    </div>
</div>

<div class="toast" id="toast"></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
<script>
    let leads = [];
    let currentFilter = 'all';
    let searchTerm = '';

    loadFromStorage();

    document.getElementById('csvFile').addEventListener('change', handleFileUpload);

    document.getElementById('searchBox').addEventListener('input', (e) => {
        searchTerm = e.target.value.toLowerCase();
        renderLeads();
    });

    document.querySelectorAll('.filter-btn').forEach(btn => {
        btn.addEventListener('click', (e) => {
            document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
            e.target.classList.add('active');
            currentFilter = e.target.dataset.filter;
            renderLeads();
        });
    });

    document.getElementById('exportBtn').addEventListener('click', exportToCSV);

    async function loadFromStorage() {
        try {
            const result = await window.storage.get('leads-data');
            if (result && result.value) {
                leads = JSON.parse(result.value);
                renderLeads();
            }
        } catch (error) {
            console.log('No saved data found');
        }
    }

    async function saveToStorage() {
        try {
            await window.storage.set('leads-data', JSON.stringify(leads));
        } catch (error) {
            console.error('Error saving data:', error);
        }
    }

    function showToast(message) {
        const toast = document.getElementById('toast');
        toast.textContent = message;
        toast.classList.add('show');
        setTimeout(() => {
            toast.classList.remove('show');
        }, 2000);
    }

    function copyToClipboard(text, type) {
        navigator.clipboard.writeText(text).then(() => {
            showToast(`${type} copied!`);
        }).catch(() => {
            showToast('Failed to copy');
        });
    }

    function handleFileUpload(e) {
        const file = e.target.files[0];
        if (!file) return;

        const extension = file.name.split('.').pop().toLowerCase();

        if (extension === 'csv') {
            Papa.parse(file, {
                header: true,
                skipEmptyLines: true,
                complete: (results) => {
                    processData(results.data);
                },
                error: (error) => {
                    alert('Error reading CSV: ' + error.message);
                }
            });
        } else if (extension === 'xlsx' || extension === 'xls') {
            const reader = new FileReader();
            reader.onload = (e) => {
                const data = new Uint8Array(e.target.result);
                const workbook = XLSX.read(data, { type: 'array' });
                const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                const jsonData = XLSX.utils.sheet_to_json(firstSheet);
                processData(jsonData);
            };
            reader.readAsArrayBuffer(file);
        }
    }

    function processData(data) {
      leads = data
          .map((row, index) => {
              // Find the correct column names by checking common variations
              const firstName = row['First Name'] || row['first name'] || row['FIRST NAME'] || row['firstName'] || '';
              const lastName = row['Last Name'] || row['last name'] || row['LAST NAME'] || row['lastName'] || '';
              const fullName = `${firstName} ${lastName}`.trim() || row.Name || row.name || row.NAME || '';
              const email = row.Email || row.email || row.EMAIL || '';
              
              // Look for company name with various possible column names
              const company = row['Company Name'] || row['Company name'] || row['company name'] || 
                            row['COMPANY NAME'] || row.Company || row.company || row.COMPANY || '';

              return {
                  id: index,
                  name: fullName,
                  email: email,
                  company: company,
                  status: 'todo', // todo, in-progress, completed
                  dateCompleted: null
              };
          })
          .filter(lead => {
              // Only remove rows that have NO data at all
              const hasAnyData = lead.name || lead.email || lead.company;
              return hasAnyData;
          })
          .map((lead, index) => ({
              ...lead,
              id: index // Re-index after filtering
          }));

      saveToStorage();
      renderLeads();
      
      const filteredCount = data.length - leads.length;
      if (filteredCount > 0) {
          showToast(`${leads.length} leads imported! (${filteredCount} empty rows removed)`);
      } else {
          showToast(`${leads.length} leads imported successfully!`);
      }
  }

    function toggleLead(id) {
        const lead = leads.find(l => l.id === id);
        if (lead) {
            // Cycle through states: todo -> in-progress -> completed -> todo
            if (lead.status === 'todo') {
                lead.status = 'in-progress';
                lead.dateCompleted = null;
                showToast('Lead marked as In Progress (Yellow)');
            } else if (lead.status === 'in-progress') {
                lead.status = 'completed';
                lead.dateCompleted = new Date().toISOString();
                showToast('Lead marked as Completed (Green)');
            } else {
                lead.status = 'todo';
                lead.dateCompleted = null;
                showToast('Lead marked as To Do');
            }
            saveToStorage();
            renderLeads();
        }
    }

    function updateNotes(id, notes) {
        const lead = leads.find(l => l.id === id);
        if (lead) {
            lead.notes = notes;
            saveToStorage();
        }
    }

    function renderLeads() {
        const mainContainer = document.getElementById('leadsList');
        const quickContainer = document.getElementById('quickLeadsList');
        
        let filteredLeads = leads.filter(lead => {
            const matchesSearch = 
                lead.name.toLowerCase().includes(searchTerm) ||
                lead.email.toLowerCase().includes(searchTerm) ||
                lead.company.toLowerCase().includes(searchTerm);

            const matchesFilter = 
                currentFilter === 'all' ||
                (currentFilter === 'done' && lead.status === 'completed') ||
                (currentFilter === 'progress' && lead.status === 'in-progress') ||
                (currentFilter === 'todo' && lead.status === 'todo');

            return matchesSearch && matchesFilter;
        });

        const total = leads.length;
        const inProgress = leads.filter(l => l.status === 'in-progress').length;
        const completed = leads.filter(l => l.status === 'completed').length;
        const toGo = total - inProgress - completed;
        const progress = total > 0 ? Math.round((completed / total) * 100) : 0;

        document.getElementById('totalLeads').textContent = total;
        document.getElementById('inProgressLeads').textContent = inProgress;
        document.getElementById('completedLeads').textContent = completed;
        document.getElementById('toGoLeads').textContent = toGo;
        document.getElementById('progressPercent').textContent = progress + '%';

        if (filteredLeads.length === 0) {
            const emptyMessage = leads.length === 0 
                ? '<div class="empty-state"><h3>No Leads Yet</h3><p>Upload a CSV or Excel file to get started</p></div>'
                : '<div class="empty-state"><h3>No Matches Found</h3><p>Try adjusting your search or filter</p></div>';
            
            mainContainer.innerHTML = emptyMessage;
            quickContainer.innerHTML = '<div class="empty-state"><p>No leads to display</p></div>';
            return;
        }

        const leadsHTML = filteredLeads.map(lead => {
            let statusClass = '';
            let checkboxClass = '';
            let checkIcon = '';
            
            if (lead.status === 'in-progress') {
                statusClass = 'in-progress';
                checkboxClass = 'in-progress';
                checkIcon = '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><line x1="5" y1="12" x2="19" y2="12"></line></svg>';
            } else if (lead.status === 'completed') {
                statusClass = 'completed';
                checkboxClass = 'checked';
                checkIcon = '<svg viewBox="0 0 24 24" fill="none"><polyline points="20 6 9 17 4 12"></polyline></svg>';
            }
            
            return `
            <div class="lead-card ${statusClass}">
                <div class="lead-header">
                    <div class="checkbox ${checkboxClass}" onclick="toggleLead(${lead.id})">
                        ${checkIcon}
                    </div>
                    <div class="lead-info">
                        <div class="lead-name">
                            <span class="name-text">${lead.name || 'N/A'}</span>
                            ${lead.name ? `<button class="copy-btn" onclick="copyToClipboard('${lead.name}', 'Name')">Copy</button>` : ''}
                        </div>
                        <div class="lead-detail">
                            <span>üè¢</span>
                            <div class="detail-content">
                                <span class="detail-text">${lead.company || 'N/A'}</span>
                            </div>
                        </div>
                        <div class="lead-detail">
                            <span>‚úâÔ∏è</span>
                            <div class="detail-content">
                                <span class="detail-text">${lead.email || 'N/A'}</span>
                                ${lead.email ? `<button class="copy-btn" onclick="copyToClipboard('${lead.email}', 'Email')">Copy</button>` : ''}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        `;
        }).join('');

        mainContainer.innerHTML = leadsHTML;

        const quickLeadsHTML = filteredLeads.slice(0, 5).map(lead => {
            let checkboxClass = '';
            let checkIcon = '';
            
            if (lead.status === 'in-progress') {
                checkboxClass = 'in-progress';
                checkIcon = '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><line x1="5" y1="12" x2="19" y2="12"></line></svg>';
            } else if (lead.status === 'completed') {
                checkboxClass = 'checked';
                checkIcon = '<svg viewBox="0 0 24 24" fill="none"><polyline points="20 6 9 17 4 12"></polyline></svg>';
            }
            
            return `
            <div class="lead-card ${lead.status === 'completed' ? 'completed' : lead.status === 'in-progress' ? 'in-progress' : ''}" style="margin-bottom: 10px; padding: 14px;">
                <div style="display: flex; align-items: center; gap: 10px;">
                    <div class="checkbox ${checkboxClass}" onclick="toggleLead(${lead.id})" style="width: 20px; height: 20px; min-width: 20px;">
                        ${checkIcon}
                    </div>
                    <div style="flex: 1; overflow: hidden;">
                        <div style="font-weight: 600; font-size: 0.95em; margin-bottom: 4px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">${lead.name || 'N/A'}</div>
                        <div style="font-size: 0.8em; color: #6c757d; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">${lead.email || 'N/A'}</div>
                    </div>
                </div>
            </div>
        `;
        }).join('');

        quickContainer.innerHTML = quickLeadsHTML || '<div class="empty-state"><p>No leads to display</p></div>';
    }

    function exportToCSV() {
        if (leads.length === 0) {
            showToast('No leads to export!');
            return;
        }

        const csvData = leads.map(lead => ({
            Name: lead.name,
            Email: lead.email,
            Company: lead.company,
            Status: lead.status === 'completed' ? 'Completed' : lead.status === 'in-progress' ? 'In Progress' : 'To Do',
            'Date Completed': lead.dateCompleted ? new Date(lead.dateCompleted).toLocaleDateString() : ''
        }));

        const csv = Papa.unparse(csvData);
        const blob = new Blob([csv], { type: 'text/csv' });
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `leads_export_${new Date().toISOString().split('T')[0]}.csv`;
        a.click();
        window.URL.revokeObjectURL(url);
        showToast('CSV exported successfully!');
    }
</script>
</body>
</html>